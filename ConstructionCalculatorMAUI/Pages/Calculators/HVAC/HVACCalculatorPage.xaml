<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConstructionCalculatorMAUI.Pages.Calculators.HVAC.HVACCalculatorPage"
             Title="HVAC Multi-Zone Calculator">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Help" Clicked="OnHelpClicked" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            
            <!-- Description -->
            <Label Text="Calculate heating and cooling requirements for multiple zones.&#x0a;Add zones with their dimensions and conditions to determine total system requirements."
                   FontSize="12"
                   FontAttributes="Italic"
                   TextColor="Gray" />

            <!-- Add Zone Section -->
            <Frame BorderColor="Gray" Padding="15" CornerRadius="5">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Add Zone" FontSize="16" FontAttributes="Bold" />
                    
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Zone Name:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="ZoneNameEntry" WidthRequest="200" Placeholder="Optional name" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Length:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="LengthEntry" WidthRequest="100" Keyboard="Numeric" Placeholder="0" />
                        <Label Text="ft" VerticalOptions="Center" />
                        <Label Text="Width:" WidthRequest="60" VerticalOptions="Center" Margin="10,0,0,0" />
                        <Entry x:Name="WidthEntry" WidthRequest="100" Keyboard="Numeric" Placeholder="0" />
                        <Label Text="ft" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Ceiling Height:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="HeightEntry" WidthRequest="100" Keyboard="Numeric" Text="8" />
                        <Label Text="ft" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Insulation:" WidthRequest="120" VerticalOptions="Center" />
                        <Picker x:Name="InsulationPicker" WidthRequest="200" SelectedIndex="1">
                            <Picker.Items>
                                <x:String>Poor (old/minimal)</x:String>
                                <x:String>Average (standard)</x:String>
                                <x:String>Good (modern/upgraded)</x:String>
                                <x:String>Excellent (high-efficiency)</x:String>
                            </Picker.Items>
                        </Picker>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Sun Exposure:" WidthRequest="120" VerticalOptions="Center" />
                        <Picker x:Name="SunExposurePicker" WidthRequest="200" SelectedIndex="1">
                            <Picker.Items>
                                <x:String>Shaded (north-facing)</x:String>
                                <x:String>Moderate</x:String>
                                <x:String>High (south/west-facing)</x:String>
                            </Picker.Items>
                        </Picker>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Climate Zone:" WidthRequest="120" VerticalOptions="Center" />
                        <Picker x:Name="ClimateZonePicker" WidthRequest="200" SelectedIndex="1">
                            <Picker.Items>
                                <x:String>Cold (Zone 1-3)</x:String>
                                <x:String>Moderate (Zone 4-5)</x:String>
                                <x:String>Hot (Zone 6-8)</x:String>
                            </Picker.Items>
                        </Picker>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Windows:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="WindowsEntry" WidthRequest="80" Keyboard="Numeric" Text="2" />
                        <Label Text="Occupants:" WidthRequest="80" VerticalOptions="Center" Margin="10,0,0,0" />
                        <Entry x:Name="OccupantsEntry" WidthRequest="80" Keyboard="Numeric" Text="2" />
                    </HorizontalStackLayout>

                    <CheckBox x:Name="KitchenCheckBox">
                        <CheckBox.Triggers>
                            <DataTrigger TargetType="CheckBox" Binding="{Binding Source={x:Reference KitchenCheckBox}, Path=IsChecked}" Value="True">
                                <Setter Property="Color" Value="{AppThemeBinding Light=#FF6B35, Dark=#FF6B35}" />
                            </DataTrigger>
                        </CheckBox.Triggers>
                    </CheckBox>
                    <Label Text="Has kitchen or heat-generating appliances" VerticalOptions="Center" Margin="0,-35,0,0" Padding="40,0,0,0" />

                    <Button Text="Add Zone" 
                            Style="{StaticResource PrimaryButton}"
                            Clicked="AddZoneButton_Clicked" />
                </VerticalStackLayout>
            </Frame>

            <!-- Zones List -->
            <Frame BorderColor="Gray" Padding="15" CornerRadius="5">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Zones" FontSize="16" FontAttributes="Bold" />
                    <CollectionView x:Name="ZonesCollectionView" HeightRequest="120" SelectionMode="Single">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding .}" FontSize="12" Padding="5" />
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Button Text="Remove Selected Zone" 
                                WidthRequest="180"
                                Style="{StaticResource ActionButton}"
                                Clicked="RemoveZoneButton_Clicked" />
                        <Button Text="Clear All Zones" 
                                WidthRequest="140"
                                Style="{StaticResource ActionButton}"
                                Clicked="ClearAllZonesButton_Clicked" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- System Totals -->
            <Frame BorderColor="Gray" Padding="15" BackgroundColor="#F5F5F5" CornerRadius="5">
                <VerticalStackLayout Spacing="8">
                    <Label Text="System Totals:" FontSize="16" FontAttributes="Bold" />
                    <Label x:Name="TotalSquareFeetLabel" Text="Total Area: 0 sq ft" FontSize="13" />
                    <Label x:Name="TotalHeatingBTULabel" Text="Total Heating BTU: 0 BTU/hr" 
                           FontSize="14" FontAttributes="Bold" TextColor="DarkRed" />
                    <Label x:Name="TotalCoolingBTULabel" Text="Total Cooling BTU: 0 BTU/hr" 
                           FontSize="14" FontAttributes="Bold" TextColor="DarkBlue" />
                    <Label x:Name="TotalTonnageLabel" Text="Total AC Tonnage: 0.0 tons" 
                           FontSize="14" FontAttributes="Bold" TextColor="DarkGreen" />
                    <Label x:Name="TotalCFMLabel" Text="Total CFM: 0 CFM" FontSize="13" />
                    
                    <BoxView HeightRequest="1" Color="Gray" Margin="0,5,0,5" />
                    
                    <HorizontalStackLayout Spacing="10">
                        <CheckBox x:Name="DiversityFactorCheckBox" CheckedChanged="DiversityFactorCheckBox_CheckedChanged">
                            <CheckBox.Triggers>
                                <DataTrigger TargetType="CheckBox" Binding="{Binding Source={x:Reference DiversityFactorCheckBox}, Path=IsChecked}" Value="True">
                                    <Setter Property="Color" Value="{AppThemeBinding Light=#FF6B35, Dark=#FF6B35}" />
                                </DataTrigger>
                            </CheckBox.Triggers>
                        </CheckBox>
                        <Label Text="Apply Diversity Factor:" VerticalOptions="Center" Margin="-10,0,0,0" />
                        <Entry x:Name="DiversityFactorEntry" WidthRequest="60" Keyboard="Numeric" Text="85" 
                               TextChanged="DiversityFactorEntry_TextChanged" />
                        <Label Text="%" VerticalOptions="Center" />
                    </HorizontalStackLayout>
                    <Label x:Name="DiversityHeatingLabel" Text="" 
                           FontSize="12" FontAttributes="Italic" TextColor="DarkRed" />
                    <Label x:Name="DiversityCoolingLabel" Text="" 
                           FontSize="12" FontAttributes="Italic" TextColor="DarkBlue" />
                    <Label x:Name="DiversityTonnageLabel" Text="" 
                           FontSize="12" FontAttributes="Italic" TextColor="DarkGreen" />
                </VerticalStackLayout>
            </Frame>

            <!-- Duct Sizing Calculator -->
            <Label Text="Duct Sizing Calculator" FontSize="18" FontAttributes="Bold" Margin="0,20,0,10" />
            <Label Text="Calculate duct dimensions, friction loss, and pressure drop for HVAC systems. Supports round and rectangular ducts with fitting losses."
                   FontSize="12" FontAttributes="Italic" TextColor="Gray" />

            <!-- Basic Duct Sizing -->
            <Frame BorderColor="Gray" Padding="15" CornerRadius="5">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Basic Duct Sizing" FontSize="16" FontAttributes="Bold" />
                    
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Duct Type:" WidthRequest="120" VerticalOptions="Center" />
                        <Picker x:Name="DuctTypePicker" WidthRequest="200" SelectedIndex="0" SelectedIndexChanged="DuctTypePicker_SelectedIndexChanged">
                            <Picker.Items>
                                <x:String>Round</x:String>
                                <x:String>Rectangular</x:String>
                            </Picker.Items>
                        </Picker>
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Airflow (CFM):" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="DuctCFMEntry" WidthRequest="100" Keyboard="Numeric" Text="0" />
                        <Button Text="Use Total" WidthRequest="90" Style="{StaticResource ActionButton}" Clicked="UseTotalCFMButton_Clicked" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Target Velocity:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="DuctVelocityEntry" WidthRequest="100" Keyboard="Numeric" Text="800" />
                        <Label Text="FPM" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <!-- Round Duct Results -->
                    <VerticalStackLayout x:Name="RoundDuctPanel" IsVisible="True" Spacing="5" Margin="0,10,0,0">
                        <BoxView HeightRequest="1" Color="Gray" />
                        <Label x:Name="RoundDiameterLabel" Text="Diameter: --" FontSize="14" FontAttributes="Bold" />
                        <Label x:Name="RoundActualVelocityLabel" Text="Actual Velocity: --" FontSize="12" />
                    </VerticalStackLayout>

                    <!-- Rectangular Duct Results -->
                    <VerticalStackLayout x:Name="RectangularDuctPanel" IsVisible="False" Spacing="5" Margin="0,10,0,0">
                        <HorizontalStackLayout Spacing="10">
                            <Label Text="Aspect Ratio:" WidthRequest="120" VerticalOptions="Center" />
                            <Entry x:Name="AspectRatioEntry" WidthRequest="80" Keyboard="Numeric" Text="2.0" />
                            <Label Text="(W:H)" VerticalOptions="Center" />
                        </HorizontalStackLayout>
                        <BoxView HeightRequest="1" Color="Gray" />
                        <Label x:Name="RectangularSizeLabel" Text="Size: --" FontSize="14" FontAttributes="Bold" />
                        <Label x:Name="RectangularActualVelocityLabel" Text="Actual Velocity: --" FontSize="12" />
                        <Label x:Name="EquivalentDiameterLabel" Text="Equivalent Diameter: --" FontSize="12" />
                    </VerticalStackLayout>

                    <Button Text="Calculate Duct Size" 
                            Style="{StaticResource PrimaryButton}"
                            Clicked="CalculateDuctSizeButton_Clicked" Margin="0,10,0,0" />
                </VerticalStackLayout>
            </Frame>

            <!-- Run Length and Fittings -->
            <Frame BorderColor="Gray" Padding="15" CornerRadius="5">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Run Length and Fittings" FontSize="16" FontAttributes="Bold" />
                    
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Straight Length:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="StraightLengthEntry" WidthRequest="100" Keyboard="Numeric" Text="0" />
                        <Label Text="ft" VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <Label Text="Fittings (equivalent length added):" FontSize="12" FontAttributes="Bold" Margin="0,10,0,5" />

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="90° Elbows:" WidthRequest="120" VerticalOptions="Center" FontSize="12" />
                        <Entry x:Name="Elbow90Entry" WidthRequest="60" Keyboard="Numeric" Text="0" />
                        <Label Text="(~35 ft ea)" VerticalOptions="Center" FontSize="11" TextColor="Gray" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="45° Elbows:" WidthRequest="120" VerticalOptions="Center" FontSize="12" />
                        <Entry x:Name="Elbow45Entry" WidthRequest="60" Keyboard="Numeric" Text="0" />
                        <Label Text="(~20 ft ea)" VerticalOptions="Center" FontSize="11" TextColor="Gray" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Transitions:" WidthRequest="120" VerticalOptions="Center" FontSize="12" />
                        <Entry x:Name="TransitionsEntry" WidthRequest="60" Keyboard="Numeric" Text="0" />
                        <Label Text="(~15 ft ea)" VerticalOptions="Center" FontSize="11" TextColor="Gray" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Branch Takeoffs:" WidthRequest="120" VerticalOptions="Center" FontSize="12" />
                        <Entry x:Name="BranchesEntry" WidthRequest="60" Keyboard="Numeric" Text="0" />
                        <Label Text="(~25 ft ea)" VerticalOptions="Center" FontSize="11" TextColor="Gray" />
                    </HorizontalStackLayout>

                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Dampers:" WidthRequest="120" VerticalOptions="Center" FontSize="12" />
                        <Entry x:Name="DampersEntry" WidthRequest="60" Keyboard="Numeric" Text="0" />
                        <Label Text="(~10 ft ea)" VerticalOptions="Center" FontSize="11" TextColor="Gray" />
                    </HorizontalStackLayout>

                    <BoxView HeightRequest="1" Color="Gray" Margin="0,10,0,10" />
                    <Label x:Name="TotalEquivalentLengthLabel" Text="Total Equivalent Length: 0 ft" FontSize="12" FontAttributes="Bold" />
                    <Label x:Name="EffectiveLengthLabel" Text="Effective Length (straight + fittings): 0 ft" FontSize="12" />
                </VerticalStackLayout>
            </Frame>

            <!-- Friction Loss Results -->
            <Frame BorderColor="Gray" Padding="15" CornerRadius="5">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Friction Loss and Pressure Drop" FontSize="16" FontAttributes="Bold" />
                    
                    <HorizontalStackLayout Spacing="10">
                        <Label Text="Friction Rate:" WidthRequest="120" VerticalOptions="Center" />
                        <Entry x:Name="FrictionRateEntry" WidthRequest="100" Keyboard="Numeric" Text="0.08" />
                        <Label Text="in. w.g./100 ft" VerticalOptions="Center" FontSize="11" />
                    </HorizontalStackLayout>

                    <Button Text="Calculate Friction Loss" 
                            Style="{StaticResource ActionButton}"
                            Clicked="CalculateFrictionButton_Clicked" Margin="0,5,0,10" />

                    <Frame BorderColor="Gray" Padding="15" BackgroundColor="#F5F5F5" CornerRadius="5">
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Results:" FontSize="14" FontAttributes="Bold" />
                            <Label x:Name="FrictionLossLabel" Text="Friction Loss: --" FontSize="13" />
                            <Label x:Name="VelocityPressureLabel" Text="Velocity Pressure: --" FontSize="13" />
                            <Label x:Name="TotalPressureLabel" Text="Total Pressure Drop: --" FontSize="14" FontAttributes="Bold" TextColor="DarkBlue" />
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <Label Text="Note: Friction rates and equivalent lengths are typical values. Actual values may vary based on duct material, construction, and specific fittings used. Consult ASHRAE or SMACNA standards for precise calculations."
                   FontSize="11" FontAttributes="Italic" TextColor="Gray" Margin="0,10,0,0" />

            <!-- Copy Results Button -->
            <Button Text="Copy Results" 
                    Style="{StaticResource ActionButton}"
                    Clicked="CopyResultsButton_Clicked" />

            <!-- Note -->
            <Label Text="Note: These are estimates for multi-zone systems. Consult with an HVAC professional for final sizing and installation."
                   FontSize="11"
                   FontAttributes="Italic"
                   TextColor="Gray" />

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
