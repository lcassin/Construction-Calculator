<Window x:Class="ConstructionCalculator.WPF.Launcher.CalculatorLauncherWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:ConstructionCalculator.WPF.Shared.HelpSystem"
        Title="Calculator Launcher" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Icon="Assets/app.ico"
        PreviewKeyDown="Window_PreviewKeyDown">

	<Grid Margin="20" UseLayoutRounding="True">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Search Box -->
		<TextBox x:Name="SearchTextBox" 
                 Grid.Row="0"
                 Height="40"
                 FontSize="16"
                 Padding="10"
                 Margin="0,0,0,20"
                 TextChanged="SearchTextBox_TextChanged">
			<TextBox.Style>
				<Style TargetType="TextBox">
					<Style.Triggers>
						<Trigger Property="Text" Value="">
							<Setter Property="Background">
								<Setter.Value>
									<VisualBrush Stretch="None" AlignmentX="Left">
										<VisualBrush.Visual>
											<TextBlock Text="Search calculators..." 
                                                       FontSize="16" Foreground="Gray" 
                                                       Margin="10,0,0,0" VerticalAlignment="Center"/>
										</VisualBrush.Visual>
									</VisualBrush>
								</Setter.Value>
							</Setter>
						</Trigger>
					</Style.Triggers>
				</Style>
			</TextBox.Style>
		</TextBox>

		<!-- Instructions -->
		<StackPanel Grid.Row="1" Margin="0,0,0,15">
			<TextBlock Text="Select a calculator to open:" 
			           FontSize="14" 
			           Foreground="Gray"/>
			<TextBlock Text="Press F1 for context help" 
			           FontSize="12" 
			           Foreground="#0078D4"
			           FontWeight="SemiBold"
			           Margin="0,5,0,0"/>
		</StackPanel>

		<!-- Calculator Tiles -->
		<ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
			<ItemsControl x:Name="CalculatorItemsControl">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<UniformGrid Columns="3"/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
				<ItemsControl.ItemContainerStyle>
					<Style TargetType="ContentPresenter">
						<Setter Property="HorizontalAlignment" Value="Stretch"/>
						<Setter Property="Margin" Value="5"/>
					</Style>
				</ItemsControl.ItemContainerStyle>
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Grid x:Name="TileRoot"
						      MouseEnter="Tile_MouseEnter"
						      MouseLeave="Tile_MouseLeave">
							<Button x:Name="TileButton"
							        Click="CalculatorTile_Click"
	                                Tag="{Binding}"
	                                HorizontalAlignment="Stretch"
	                                VerticalAlignment="Stretch"
	                                HorizontalContentAlignment="Stretch"
	                                VerticalContentAlignment="Stretch"
	                                Padding="15"
	                                MinHeight="120"
	                                Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
								<Button.ToolTip>
									<ToolTip>
										<StackPanel>
											<TextBlock FontWeight="Bold" Text="{Binding Name}"/>
											<TextBlock Text="Press F1 for help" FontSize="11" Foreground="Gray" Margin="0,3,0,0"/>
										</StackPanel>
									</ToolTip>
								</Button.ToolTip>
								<Button.Resources>
									<Style TargetType="Border">
										<Setter Property="CornerRadius" Value="6"/>
									</Style>
								</Button.Resources>
								<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="*"/>
								</Grid.RowDefinitions>

								<!-- Category Badge -->
								<Border Grid.Row="0" 
                                        Background="#E0E0E0" 
                                        CornerRadius="3"
                                        Padding="5,2"
                                        HorizontalAlignment="Left"
                                        Margin="0,0,0,8">
									<TextBlock Text="{Binding Category}" 
                                               FontSize="10" 
                                               Foreground="#606060"/>
								</Border>

								<!-- Icon and Name Row -->
								<Grid Grid.Row="1" Margin="0,0,0,8">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto"/>
										<ColumnDefinition Width="*"/>
									</Grid.ColumnDefinitions>
									
									<!-- Icon -->
									<TextBlock Grid.Column="0" 
									           Text="{Binding Icon}" 
									           FontFamily="{Binding IconFontFamily}"
									           FontSize="24" 
									           VerticalAlignment="Center"
									           Margin="0,0,10,0"/>
									
									<!-- Calculator Name -->
									<TextBlock Grid.Column="1" 
									           Text="{Binding Name}" 
									           FontSize="16" 
									           FontWeight="Bold"
									           TextWrapping="Wrap"
									           VerticalAlignment="Center"/>
								</Grid>

								<!-- Description -->
								<TextBlock Grid.Row="3" 
                                           Text="{Binding Description}" 
                                           FontSize="12" 
                                           Foreground="Gray"
                                           TextWrapping="Wrap"
                                           TextTrimming="CharacterEllipsis"
                                           Width="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=ActualWidth}"
                                           VerticalAlignment="Top"/>
								</Grid>
							</Button>
							
							<!-- Help Button Overlay (appears on hover) -->
							<Button x:Name="HelpButton"
							        Width="28" 
							        Height="28"
							        HorizontalAlignment="Right"
							        VerticalAlignment="Top"
							        Margin="5"
							        Content="?"
							        FontWeight="Bold"
							        FontSize="14"
							        Background="#0078D4"
							        Foreground="White"
							        BorderThickness="0"
							        Cursor="Hand"
							        Click="HelpButton_Click"
							        Tag="{Binding}"
							        Panel.ZIndex="100"
							        Focusable="False"
							        IsTabStop="False"
							        FocusVisualStyle="{x:Null}">
								<Button.Resources>
									<Style TargetType="Border">
										<Setter Property="CornerRadius" Value="14"/>
									</Style>
								</Button.Resources>
								<Button.ToolTip>
									<TextBlock Text="View help for this calculator"/>
								</Button.ToolTip>
								<Button.Style>
									<Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
										<Setter Property="Visibility" Value="Collapsed"/>
										<Style.Triggers>
											<DataTrigger Binding="{Binding ElementName=TileRoot, Path=IsMouseOver}" Value="True">
												<Setter Property="Visibility" Value="Visible"/>
											</DataTrigger>
										</Style.Triggers>
									</Style>
								</Button.Style>
							</Button>
						</Grid>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
		</ScrollViewer>
	</Grid>
</Window>
